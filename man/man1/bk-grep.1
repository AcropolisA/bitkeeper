.so ../bk-macros
.TH "bk grep" 1 %E% "\*(BC" "\*(UM"
.SH NAME
bk grep \- search some/all revisions of one or more files for a pattern
.SH SYNOPSIS
.B bk grep 
[\fIoptions\fP]
.ARG pattern
.BKARGS
.SH DESCRIPTION
.LP
The bk grep command searches the named files (or standard input if the file
name - is given) for lines containing a match to the given 
.IR pattern .
The pattern may be a 
.I regular expression.
By default, bk grep prints the matching lines.
.LP
While designed to be command line compatible with GNU grep,
bk grep can search in the most recent revision of a file,
all revisions of a file, a subset of revisions of a file,
or the checked out and (possibly) modified version of a file.
By default, bk grep searches the checked out version of a file and if that is
not present then it searches the most recent version of the file.
The 
.BR \-r ,
.BR \-R ,
and 
.B \-d
options are used to control where in a file's history to search.
.LP
The printed lines may be annotated with file names,
dates, revision numbers, line numbers, and/or user names.
.SH OPTIONS
.if n .TP 1i
.if t .TP .7i
.OPTreq \-A num
Print 
.I num
lines of trailing context after matching lines.
Places a line containing -- between contiguous groups of matches.
(Like GNU grep.)
.tp
.if t \fB\-A\fP\fIbdpru\fP
.if n \fB\-A\fP\fI<bdpru>\fP
Annotate the output with information from the revision history.
Each annotation is aligned in a column.
The option argument[s] turn on one
or more annotations as a prefix to each line.
The possible annotations are:
.RS
.TP 4
.B b
Prefix each line with the basename of the file.
If a single revision was selected, the name used is the name as of that
revision, otherwise the name used is the current name.
.tp
.B d
Prefix each line with the date of last modification.
.tp
.B p
Prefix each line with the pathname of the file relative to the root
of the repository.
If a single revision was selected, the name used is the name as of that
revision, otherwise the name used is the current name.
.tp
.B r
Prefix each line with the revision of last modification.
.tp
.B u
Prefix each line the name of the user who last modified it.
.RE
There is some redundancy between the b/p options and the traditional GNU
options for listing file names.  The \*(BK options are slightly different
in the following ways: the file names listed are either the basename or
the pathname relative to the root regardless of where the command is run 
in the repository; and when using the 
.B \-A
option bk grep will attempt to align the filenames in the output but it will
not with the normal GNU style output.
.if n .TP 1i
.if t .TP .7i
.if t \fB\-a\fP\fIbdpru\fP
.if n \fB\-a\fP\fI<bdpru>\fP
Similar to
.B \-A
but each annotation is followed by a colon rather than a set of spaces
aligning the output.
.tp
.OPTreq \-B num
Print
.I num
lines of leading context before matching lines.
Places a line containing -- between contiguous groups of matches.
(Like GNU grep.)
.tp
.OPTopt \-C num
Print
.I num
lines of output context. 
Places a line containing -- between contiguous groups of matches.
If no value is given defaults to 2.
(Like GNU grep.)
.tp
.B \-c
Suppress normal output; instead print a count of matching lines for 
each input file.  With -v option (see below), count non-matching lines.
(Like GNU grep.)
.tp
.OPTreq \-d dates
Select the versions to search as all deltas created in the specified 
range of dates.
.tp
.B \-h
Do not print filenames with matches when multiple files are searched.
(Like GNU grep.)
.tp
.B \-H
Print the file name even if there is only one file being searched.
(Like GNU grep.)
Note: if either of 
.B b
or
.B f
annotations options are used then this option is overridden.
.tp
.B \-i
Ignore case distinctions in both the
.I pattern
and the input files.
(Like GNU grep.)
.tp
.B \-l
Suppress normal output; instead print the name of each input file from which
output would have normally been produced.
(Like GNU grep.)
.tp
.B \-L
Suppress normal output; instead print the name of each input file from which
no output would have normally been produced.
(Like GNU grep.)
.tp
.B \-n
Prefix each line with the line number from its input file.
(Like GNU grep.)
.tp
.B \-q
Do not produce any output.
Exit immediately with zero status if any match is  found.
(Like GNU grep.)
.tp
.OPTreq \-r rev
Only look in revision
.ARG rev
for the pattern.  
.tp
.OPTopt \-R rev
Only look in range of revisions
.ARG rev
for the pattern.  If
.ARG rev
is not specified, that implies all versions of the file[s].
The difference between this option and the previous option
is that in this case
.B "bk grep"
looks in the lines 
.B added
by the specified revision, but in the 
.B \-r
case, the entire contents of the specified version is searched.
.tp
.B \-v
Invert the sense of matching, to select non-matching lines.
(Like GNU grep.)
.tp
.B \-x
Select only those matches that exactly match the whole line.
(Like GNU grep.)
.SH EXAMPLES
To see if 
.ARG pattern
occurs anywhere in any version of any file of your tree:
.DS
$ bk -r grep -R pattern
.DE
To see if it occurs anywhere
in the most recent version of of any file of your tree:
.DS
$ bk -r grep -r+ pattern
.DE
To see if it occurs anywhere in any of your checked out files (this may
be substantially faster than searching all files):
.DS
$ bk -Gr grep pattern
.DE
.DE
To see if it occurs anywhere in any of your files, including checked out
and modified files:
.DS
$ bk -r grep pattern
.DE
To see if it was added by the most recent delta
made in of any file of your tree:
.DS
$ bk -r grep -R+ pattern
.DE
.SH BUGS
The ways of specifying which versions to search are non-obvious.  You
need to read the examples carefully.  We made the default be the most
useful/common one.
.LP
Binary files are never searched, they are silently ignored.
.LP
There really ought to be a way to grep changes made by a changeset
or range of changesets.
.SH "SEE ALSO"
.BR grep (1)
.br
.SA bk 1
.SA cat 1
.SA get 1
.SA range 1
.SA regex 1
.SA sccscat 1
.SH CATEGORY
.B File
