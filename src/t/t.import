#!/bin/sh

# Copyright (c) 1999 Andrew Chang
# %K%

echo $N Test import plain file ......................................$NL
HERE=`${CWD}`
echo "logging: /dev/null" > $HERE/c
echo "logging_ok: no" >>$HERE/c
bk setup -f -n'BitKeeper Test repository' -c$HERE/c project
mkdir -p import_dir/src
${ECHO} foo > import_dir/src/foo.c
touch import_dir/src/boo.c
( echo plain; echo no ) | bk import import_dir project > import.out 2>&1
cd $HERE/project/src
get $Q foo.c
cmp -s foo.c $HERE/import_dir/src/foo.c
if [ $? -ne 0 ]; then echo failed; cat import.out; exit 1; fi
get $Q boo.c
cmp -s boo.c $HERE/import_dir/src/boo.c
if [ $? -ne 0 ]; then echo failed; cat import.out; exit 1; fi
echo OK
echo $N Test import patch file ......................................$NL
cd $HERE
mkdir -p import_new/src
${ECHO} "foo-new" > $HERE/import_new/src/foo.c
diff -Nru import_dir import_new > test_patch
( echo patch; echo no ) | bk import test_patch project > import.out 2>&1
cd $HERE/project/src
get $Q foo.c
cmp -s foo.c $HERE/import_new/src/foo.c
if [ $? -ne 0 ]; then echo failed; cat import.out; exit 1; fi
echo OK
echo $N Test import sccs file .......................................$NL
cd $HERE
mkdir -p import_sccs/src
cd $HERE/import_sccs/src
${ECHO} bar > bar.c
ci $Q -i -l bar.c
${ECHO} "bar-new" > bar.c
ci $Q -y bar.c
cd $HERE
( echo SCCS; echo no ) | bk import import_sccs project  > import.out 2>&1
cd $HERE/project/src
get $Q bar.c $HERE/import_sccs/src/bar.c
cmp -s bar.c $HERE/import_sccs/src/bar.c
if [ $? -ne 0 ]; then echo failed; cat import.out; exit 1; fi
echo OK
